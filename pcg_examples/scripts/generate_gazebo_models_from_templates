#/bin/bash

TEMPLATES_FOLDER=$(rospack find pcg_examples)/templates/models
MODELS_FOLDER=$(rospack find pcg_examples)/models

for TEMPLATE_FILE in $(ls ${TEMPLATES_FOLDER});
do
    MODEL_NAME=$(echo "$TEMPLATE_FILE" | cut -f 1 -d '.')
    echo "Processing model template=${TEMPLATE_FILE}"
    echo "Model name=${MODEL_NAME}"

    if [ ! -d ${MODELS_FOLDER}/${MODEL_NAME} ]; then
        mkdir -p ${MODELS_FOLDER}/${MODEL_NAME}
    fi

    rosrun pcg_gazebo process_jinja_template \
        -i $(rospack find pcg_libraries)/sdf/model.config.jinja \
        -o ${MODELS_FOLDER}/${MODEL_NAME}/model.config \
        -p model_name=${MODEL_NAME} \
        -p version=1.0 \
        -p sdf_version=1.6 \
        -p author_name=$(whoami) \
        -p author_email=$(whoami)@email.com \
        -p sdf_filename=model.sdf

    rosrun pcg_gazebo process_jinja_template \
        -i ${TEMPLATES_FOLDER}/${TEMPLATE_FILE} \
        -o ${MODELS_FOLDER}/${MODEL_NAME}/model.sdf

    echo "${MODEL_NAME} generated in ${MODELS_FOLDER}/${MODEL_NAME}"
done